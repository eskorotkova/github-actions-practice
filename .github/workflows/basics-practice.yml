#-----------------------------------------
# GitHub Actions Basics
#
# Tutorial by Denis Astahov
#-----------------------------------------
name: githubActions-practice-basics # Visible name of a file which will be used in configurations. 

# зададим глобальные переменные для данного файла
env:
  APPLICATION_NAME   : "MyFlask"
  DEPLOY_PACKAGE_NAME: "flask-deploy-ver-${{ github.sha }}" # github.sha == SHA-код коммита

on: #[push] # when to trigger this automatization ex: [push,pull_request]
  push:
    branches:
      - master # trigger this automatization file only after PUSH action and only into BRANCH "master"
  

jobs: # it's possible to have many different jobs in 1 file
  my_testing: # job-name

    runs-on: ubuntu-latest # which server to use (using dockerfile with latest ubuntu server) also called "runners"

    steps: # which steps to do (which commands to run) aka Tasks in Ansible
    - name: print Hello message
      run: echo "Hello, World from Testing job!" # the same as SHELL in Ansible
    
    - name: Run a multi-line sript
      run: |
        echo "Add other actions to build,"
        echo "test, and deploy your project."
        echo "Application name: ${{ env.APPLICATION_NAME }}"

    - name: List current folder
      run : ls -la 

    - name: Git clone my repo # копирует файлы из нашего гит репозитория
      uses: actions/checkout@v1 # uses - используется для запуска скриптов. обычно используется вначале файла. 

    - name: List current folder # запускаем второй раз и проверяем результат клонирования репозитория
      run : ls -la 

  my_deploy: # job-name
    runs-on: ubuntu-latest
    needs: [my_testing] # джоба my_deploy запуститтся ТОЛЬКО ПОСЛЕ успешного выполнения джобы my_testing. без этого параметра джобы запускаются одновременно. 
    
    # переменные для конкретной джобы
    env: 
      VAR1: "This is Job Level Variable1"
      VAR2: "This is Job Level Variable2"
    
    steps:
    - name: print Hello message
      run: echo "Hello, World from Deploy job!"

    - name: Print env vars
      run : |
        echo "Var1 = ${{ env.VAR1 }}"
        echo "Var2 = ${{ env.VAR2 }}"
        echo "Var3 = $LOCAL_VAR"
      # переменные локальные только для этого шага
      env:
        LOCAL_VAR: "This is Super local Env Variable"
    
    - name: Printing Deployment package
      run: echo "Package name is ${{ env.DEPLOY_PACKAGE_NAME }}"

    - name: Lets test some packages if existed ver-1
      run : aws --version

    - name: Lets test some packages if existed ver-2
    # using echo "\n" to print results on their own lines
      run : |
        zip --version
        docker --version
